{
  "created": "2024-02-24T13:50:13.749290",
  "_message": "unit test - maximal.yaml",
  "target": [],
  "_title": null,
  "id": "a269ede0-d31b-11ee-b23f-725daeea5112",
  "snapshot_image_path": null,
  "delivered": 0,
  "errored": 5,
  "skipped": 2,
  "delivered_envelopes": [
    {
      "targets": [
        "media_player.kitchen_2"
      ],
      "config": {
        "method": "media",
        "service": "media_player.play_media",
        "target": [
          "media_player.kitchen_2"
        ],
        "selection": [
          "default"
        ],
        "options": {},
        "occupancy": "all",
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "alexa_show"
      },
      "delivery_name": "alexa_show",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 0,
      "skipped": 0,
      "calls": [],
      "failed_calls": [],
      "delivery_error": null
    },
    {
      "targets": [],
      "config": {
        "method": "mobile_push",
        "selection": [
          "default"
        ],
        "options": {
          "timestamp": "%H:%M"
        },
        "occupancy": "all",
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "mobile_push"
      },
      "delivery_name": "mobile_push",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 0,
      "skipped": 0,
      "calls": [],
      "failed_calls": [],
      "delivery_error": null
    },
    {
      "targets": [
        "script.chime_ding_dong",
        "switch.chime_sax",
        "media_player.echo_lobby"
      ],
      "config": {
        "method": "chime",
        "target": [
          "script.chime_ding_dong",
          "switch.chime_sax",
          "media_player.echo_lobby"
        ],
        "occupancy": "any_in",
        "selection": [
          "default"
        ],
        "options": {
          "chime_aliases": {
            "doorbell": {
              "media_player": "amzn_sfx_doorbell_chime_02",
              "switch": {
                "entity_id": "switch.chime_ding_dong"
              }
            },
            "red_alert": {
              "media_player": "amzn_sfx_scifi_alarm_04",
              "siren": {
                "tune": "emergency"
              }
            },
            "known_vehicle": {
              "media_player": "amzn_sfx_trumpet_bugle_04",
              "switch": {
                "entity_id": "switch.chime_sax"
              }
            },
            "unknown_vehicle": {
              "media_player": "amzn_sfx_church_bell_1x_02",
              "switch": {
                "entity_id": "switch.chime_big_ben"
              }
            },
            "generic": {
              "media_player": "amzn_sfx_doorbell_01",
              "switch": {
                "entity_id": "switch.chime_scale"
              }
            },
            "person": {
              "media_player": "bell_02",
              "switch": {
                "entity_id": "switch.chime_ding"
              }
            },
            "xmas_person": {
              "media_player": "christmas_05"
            }
          }
        },
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "play_chimes"
      },
      "delivery_name": "play_chimes",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 2,
      "skipped": 0,
      "calls": [],
      "failed_calls": [
        [
          "script",
          "chime_ding_dong",
          {
            "variables": {
              "message": "unit test - maximal.yaml"
            }
          },
          "Service script.chime_ding_dong not found.",
          0.0000209808349609375
        ],
        [
          "switch",
          "turn_on",
          {
            "entity_id": "switch.chime_sax"
          },
          "Service switch.turn_on not found.",
          0.0000209808349609375
        ]
      ],
      "delivery_error": [
        "Traceback (most recent call last):\n",
        "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 174, in call_service\n    await self.hass.services.async_call(domain, service, service_data=service_data)\n",
        "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/core.py\", line 2224, in async_call\n    raise ServiceNotFound(domain, service) from None\n",
        "homeassistant.exceptions.ServiceNotFound: Service switch.turn_on not found.\n"
      ]
    },
    {
      "targets": [
        "media_player.kitchen",
        "media_player.bedroom",
        "media_player.hall_flex",
        "media_player.old_kitchen_flex",
        "media_player.studio"
      ],
      "config": {
        "method": "alexa",
        "service": "notify.alexa",
        "occupancy": "any_in",
        "selection": [
          "default"
        ],
        "options": {
          "title_only": true
        },
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "alexa_announce",
        "target": [
          "media_player.kitchen",
          "media_player.bedroom",
          "media_player.hall_flex",
          "media_player.old_kitchen_flex",
          "media_player.studio"
        ]
      },
      "delivery_name": "alexa_announce",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 1,
      "skipped": 0,
      "calls": [],
      "failed_calls": [
        [
          "notify",
          "alexa",
          {
            "message": "unit test - maximal.yaml",
            "data": {
              "type": "announce"
            },
            "target": [
              "media_player.kitchen",
              "media_player.bedroom",
              "media_player.hall_flex",
              "media_player.old_kitchen_flex",
              "media_player.studio"
            ]
          },
          "Service notify.alexa not found.",
          0.000010013580322265625
        ]
      ],
      "delivery_error": [
        "Traceback (most recent call last):\n",
        "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 174, in call_service\n    await self.hass.services.async_call(domain, service, service_data=service_data)\n",
        "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/core.py\", line 2224, in async_call\n    raise ServiceNotFound(domain, service) from None\n",
        "homeassistant.exceptions.ServiceNotFound: Service notify.alexa not found.\n"
      ]
    },
    {
      "targets": [
        "media_player.echo_lobby"
      ],
      "config": {
        "method": "chime",
        "target": [
          "media_player.echo_lobby"
        ],
        "data": {
          "chime_tune": "amzn_sfx_doorbell_chime_01"
        },
        "selection": [
          "default"
        ],
        "options": {
          "chime_aliases": {
            "doorbell": {
              "media_player": "amzn_sfx_doorbell_chime_02",
              "switch": {
                "entity_id": "switch.chime_ding_dong"
              }
            },
            "red_alert": {
              "media_player": "amzn_sfx_scifi_alarm_04",
              "siren": {
                "tune": "emergency"
              }
            },
            "known_vehicle": {
              "media_player": "amzn_sfx_trumpet_bugle_04",
              "switch": {
                "entity_id": "switch.chime_sax"
              }
            },
            "unknown_vehicle": {
              "media_player": "amzn_sfx_church_bell_1x_02",
              "switch": {
                "entity_id": "switch.chime_big_ben"
              }
            },
            "generic": {
              "media_player": "amzn_sfx_doorbell_01",
              "switch": {
                "entity_id": "switch.chime_scale"
              }
            },
            "person": {
              "media_player": "bell_02",
              "switch": {
                "entity_id": "switch.chime_ding"
              }
            },
            "xmas_person": {
              "media_player": "christmas_05"
            }
          }
        },
        "occupancy": "all",
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "doorbell_chime_alexa"
      },
      "delivery_name": "doorbell_chime_alexa",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 1,
      "skipped": 0,
      "calls": [],
      "failed_calls": [
        [
          "media_player",
          "play_media",
          {
            "entity_id": "media_player.echo_lobby",
            "media_content_type": "sound",
            "media_content_id": "amzn_sfx_doorbell_chime_01"
          },
          "Service media_player.play_media not found.",
          9.059906005859375e-6
        ]
      ],
      "delivery_error": [
        "Traceback (most recent call last):\n",
        "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 174, in call_service\n    await self.hass.services.async_call(domain, service, service_data=service_data)\n",
        "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/core.py\", line 2224, in async_call\n    raise ServiceNotFound(domain, service) from None\n",
        "homeassistant.exceptions.ServiceNotFound: Service media_player.play_media not found.\n"
      ]
    },
    {
      "targets": [
        "switch.garden_shed_chime"
      ],
      "config": {
        "method": "generic",
        "service": "notify.megacorp_api",
        "selection": [
          "scenario",
          "fallback_on_error"
        ],
        "options": {},
        "occupancy": "all",
        "default": false,
        "priority": [
          "low",
          "medium",
          "high",
          "critical"
        ],
        "enabled": true,
        "name": "expensive_api_call"
      },
      "delivery_name": "expensive_api_call",
      "notification_id": "a269ede0-d31b-11ee-b23f-725daeea5112",
      "media": {},
      "actions": {},
      "priority": "low",
      "message": "unit test - maximal.yaml",
      "message_html": null,
      "title": null,
      "resolved": {},
      "data": {},
      "delivered": 0,
      "errored": 1,
      "skipped": 0,
      "calls": [],
      "failed_calls": [
        [
          "notify",
          "megacorp_api",
          {
            "message": "unit test - maximal.yaml",
            "target": [
              "switch.garden_shed_chime"
            ],
            "data": {}
          },
          "Service notify.megacorp_api not found.",
          8.821487426757812e-6
        ]
      ],
      "delivery_error": [
        "Traceback (most recent call last):\n",
        "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 174, in call_service\n    await self.hass.services.async_call(domain, service, service_data=service_data)\n",
        "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/core.py\", line 2224, in async_call\n    raise ServiceNotFound(domain, service) from None\n",
        "homeassistant.exceptions.ServiceNotFound: Service notify.megacorp_api not found.\n"
      ]
    }
  ],
  "undelivered_envelopes": [],
  "priority": "low",
  "message_html": null,
  "requested_scenarios": [],
  "delivery_selection": "implicit",
  "delivery_overrides_type": "dict",
  "delivery_overrides": {
    "testing": null
  },
  "recipients_override": null,
  "data": {},
  "media": {},
  "debug": false,
  "actions": {},
  "delivery_results": {},
  "delivery_errors": {
    "html_email": [
      "Traceback (most recent call last):\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/notification.py\", line 185, in call_delivery_method\n    await delivery_method.deliver(self, delivery=delivery)\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 100, in deliver\n    if not await self.evaluate_delivery_conditions(delivery_config):\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 162, in evaluate_delivery_conditions\n    return test(self.hass)\n           ^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/helpers/condition.py\", line 179, in wrapper\n    result = condition(hass, variables)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/helpers/condition.py\", line 305, in if_or_condition\n    raise ConditionErrorContainer(\"or\", errors=errors)\n",
      "homeassistant.exceptions.ConditionErrorContainer: In 'or' (item 1 of 2):\n  In 'state':\n    In 'state' condition: unknown entity alarm_control_panel.home_alarm_control\n"
    ],
    "sleigh_bells": [
      "Traceback (most recent call last):\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/notification.py\", line 185, in call_delivery_method\n    await delivery_method.deliver(self, delivery=delivery)\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 100, in deliver\n    if not await self.evaluate_delivery_conditions(delivery_config):\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/custom_components/supernotify/delivery_method.py\", line 160, in evaluate_delivery_conditions\n    conditions = cv.CONDITION_SCHEMA(delivery_config.get(CONF_CONDITION))\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/schema_builder.py\", line 272, in __call__\n    return self._compiled([], data)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 229, in _run\n    return self._exec(self._compiled, value, path)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 280, in _exec\n    raise error if self.msg is None else AnyInvalid(\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 274, in _exec\n    return func(path, v)\n           ^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 229, in _run\n    return self._exec(self._compiled, value, path)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 355, in _exec\n    raise e if self.msg is None else AllInvalid(self.msg, path=path)\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/validators.py\", line 353, in _exec\n    v = func(path, v)\n        ^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/schema_builder.py\", line 818, in validate_callable\n    return schema(data)\n           ^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/homeassistant/helpers/config_validation.py\", line 1001, in key_value_validator\n    return cast(dict[Hashable, Any], value_schemas[key_value](value))\n                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/schema_builder.py\", line 272, in __call__\n    return self._compiled([], data)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/schema_builder.py\", line 595, in validate_dict\n    return base_validate(path, iteritems(data), out)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "  File \"/Users/jey/Code/hass_supernotify/.venv/lib/python3.12/site-packages/voluptuous/schema_builder.py\", line 433, in validate_mapping\n    raise er.MultipleInvalid(errors)\n",
      "voluptuous.error.MultipleInvalid: template value should be a string for dictionary value @ data['value_template']\n"
    ]
  },
  "resolved": {
    "alexa_show": {
      "2b_delivery_config_target": [
        "media_player.kitchen_2"
      ]
    },
    "mobile_push": {
      "2d_recipients_by_occupancy": [
        {
          "person": "person.new_home_owner",
          "alias": "sysadmin",
          "email": "jrb@jeymail.net",
          "phone_number": "+447989408889",
          "delivery": {
            "mobile_push": {
              "target": [
                "mobile_app.new_iphone"
              ],
              "data": {
                "push": {
                  "sound": {
                    "name": "default"
                  }
                }
              },
              "enabled": true
            },
            "alexa_announce": {
              "target": [
                "media_player.echo_study"
              ],
              "enabled": true
            }
          },
          "mobile_devices": [],
          "mobile_discovery": true
        },
        {
          "person": "person.bidey_in",
          "phone_number": "+4489393013834",
          "target": [
            "switch.garden_shed_chime"
          ],
          "mobile_discovery": false,
          "mobile_devices": [
            {
              "manufacturer": "nokia",
              "model": "6110",
              "notify_service": "notify.mobile_old",
              "device_tracker": "device_tracker.nokia_6110"
            }
          ],
          "delivery": {
            "text_message": {
              "enabled": false
            }
          }
        }
      ],
      "2d_recipients_by_occupancy_filtered": [
        {
          "person": "person.new_home_owner",
          "alias": "sysadmin",
          "email": "jrb@jeymail.net",
          "phone_number": "+447989408889",
          "delivery": {
            "mobile_push": {
              "target": [
                "mobile_app.new_iphone"
              ],
              "data": {
                "push": {
                  "sound": {
                    "name": "default"
                  }
                }
              },
              "enabled": true
            },
            "alexa_announce": {
              "target": [
                "media_player.echo_study"
              ],
              "enabled": true
            }
          },
          "mobile_devices": [],
          "mobile_discovery": true
        },
        {
          "person": "person.bidey_in",
          "phone_number": "+4489393013834",
          "target": [
            "switch.garden_shed_chime"
          ],
          "mobile_discovery": false,
          "mobile_devices": [
            {
              "manufacturer": "nokia",
              "model": "6110",
              "notify_service": "notify.mobile_old",
              "device_tracker": "device_tracker.nokia_6110"
            }
          ],
          "delivery": {
            "text_message": {
              "enabled": false
            }
          }
        }
      ]
    },
    "play_chimes": {
      "2b_delivery_config_target": [
        "script.chime_ding_dong",
        "switch.chime_sax",
        "media_player.echo_lobby"
      ]
    },
    "alexa_announce": {
      "2b_delivery_config_target": [
        "media_player.kitchen",
        "media_player.bedroom",
        "media_player.hall_flex",
        "media_player.old_kitchen_flex",
        "media_player.studio"
      ]
    },
    "doorbell_chime_alexa": {
      "2b_delivery_config_target": [
        "media_player.echo_lobby"
      ]
    },
    "expensive_api_call": {
      "2d_recipients_by_occupancy": [
        {
          "person": "person.new_home_owner",
          "alias": "sysadmin",
          "email": "jrb@jeymail.net",
          "phone_number": "+447989408889",
          "delivery": {
            "mobile_push": {
              "target": [
                "mobile_app.new_iphone"
              ],
              "data": {
                "push": {
                  "sound": {
                    "name": "default"
                  }
                }
              },
              "enabled": true
            },
            "alexa_announce": {
              "target": [
                "media_player.echo_study"
              ],
              "enabled": true
            }
          },
          "mobile_devices": [],
          "mobile_discovery": true
        },
        {
          "person": "person.bidey_in",
          "phone_number": "+4489393013834",
          "target": [
            "switch.garden_shed_chime"
          ],
          "mobile_discovery": false,
          "mobile_devices": [
            {
              "manufacturer": "nokia",
              "model": "6110",
              "notify_service": "notify.mobile_old",
              "device_tracker": "device_tracker.nokia_6110"
            }
          ],
          "delivery": {
            "text_message": {
              "enabled": false
            }
          }
        }
      ],
      "2d_recipients_by_occupancy_filtered": [
        {
          "person": "person.new_home_owner",
          "alias": "sysadmin",
          "email": "jrb@jeymail.net",
          "phone_number": "+447989408889",
          "delivery": {
            "mobile_push": {
              "target": [
                "mobile_app.new_iphone"
              ],
              "data": {
                "push": {
                  "sound": {
                    "name": "default"
                  }
                }
              },
              "enabled": true
            },
            "alexa_announce": {
              "target": [
                "media_player.echo_study"
              ],
              "enabled": true
            }
          },
          "mobile_devices": [],
          "mobile_discovery": true
        },
        {
          "person": "person.bidey_in",
          "phone_number": "+4489393013834",
          "target": [
            "switch.garden_shed_chime"
          ],
          "mobile_discovery": false,
          "mobile_devices": [
            {
              "manufacturer": "nokia",
              "model": "6110",
              "notify_service": "notify.mobile_old",
              "device_tracker": "device_tracker.nokia_6110"
            }
          ],
          "delivery": {
            "text_message": {
              "enabled": false
            }
          }
        }
      ]
    }
  },
  "selected_delivery_names": [
    "alexa_show",
    "html_email",
    "sleigh_bells",
    "mobile_push",
    "play_chimes",
    "alexa_announce",
    "text_message",
    "doorbell_chime_alexa",
    "upstairs_siren"
  ],
  "enabled_scenarios": [
    "bedtime"
  ]
}